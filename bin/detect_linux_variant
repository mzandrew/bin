#!/bin/bash -e

# OS-detecting code suggestions from http://unix.stackexchange.com/questions/6345/how-can-i-get-distribution-name-and-version-number-in-a-simple-shell-script
function detect_OS_ARCH_VER_BITS {
        ARCH=$(uname -m | sed 's/x86_//;s/i[3-6]86/32/')
        if [ -f /etc/lsb-release ] && [ $(grep -c ^DISTRIB /etc/lsb-release) -gt 0 ]; then
            . /etc/lsb-release
            OS=$DISTRIB_ID
            VER=$DISTRIB_RELEASE
        elif [ -f /etc/redhat-release ]; then
            STRING=$(cat /etc/redhat-release)
            OS=$(echo $STRING | sed -e "s,^\([^ ]\+\) .*,\1,")
            VER=$(echo $STRING | sed -e "s,.* release \(.*\),\1,")
        elif [ -f /etc/debian_version ]; then
            OS=Debian  # XXX or Ubuntu??
            VER=$(cat /etc/debian_version)
        #elif [ -f /etc/redhat-release ]; then
        else
            OS=$(uname -s)
            VER=$(uname -r)
        fi
        case $(uname -m) in
        x86_64)
            BITS=64
            ;;
        i*86)
            BITS=32
            ;;
        *)
            BITS=?
            ;;
        esac
        case $(uname -m) in
        x86_64)
            ARCH=x64  # or AMD64 or Intel64 or whatever
            ;;
        i*86)
            ARCH=x86  # or IA32 or Intel32 or whatever
            ;;
        *)
            # leave ARCH as-is
            ;;
        esac
}

declare OS ARCH VER BITS

detect_OS_ARCH_VER_BITS
echo "detected the following:"
echo "        bits=$BITS"
echo "architecture=$ARCH"
echo "          OS=$OS"
echo "     version=$VER"
echo

export OS ARCH VER BITS

